head	1.2;
access;
symbols;
locks;
comment	@# @;


1.2
date	98.11.01.16.11.36;	author dante;	state Exp;
branches;
next	1.1;

1.1
date	86.03.12.15.13.58;	author dante;	state Exp;
branches;
next	;


desc
@Shell script to download Unix files to the Rainbow using Mlink.
@


1.2
log
@Download files to the Rainbow
@
text
@#! /bin/csh

# Download files to the Rainbow

set HARDDISK=E
set BATCH=down.bat
set MLEXEC=mlink.exec
set RUNMLINK="mlink -h host e $MLEXEC"
set MLCMD=ST
set UTMP="${HARDDISK}:/tmp/"
set UBIN="${HARDDISK}:/bin/"
set PAUSECMD="pause Insert next floppy"
@@ MAXFLOPPY = 393000

# CHARRATE is the average number of characters per minute transferred.
@@ CHARRATE = 60 * 60

if ("$1" != "") then
	set sources=($*)
else
	echo -n 'Enter source file names - '
	set sources=(`eval echo $<`)
endif

echo -n 'Download to which drive [e,a,b] - '
set drive=$<
if ($drive == E || $drive == e) then
	set drive
else
	set drive="${drive}:"
endif

echo -n 'Cantica abbreviation for downloaded filenames [inf,purg,para] - '
set cantica=$<

echo -n 'Commentary abbreviation for downloaded file extensions [dan,bos,etc.] - '
set commentary=$<

# Initialize the mlink transfer exec file and the micro's batch file.

rm -f $BATCH
echo "$MLCMD $BATCH ${UBIN}$BATCH" >! $MLEXEC

echo ""
echo 'The following files will be downloaded...'
@@ curfloppy = 0
@@ totalchars = 0
foreach s ($sources)
	set d="${cantica}`base $s`.${commentary}"
	echo $s "	-> " $d
	set wcout=`wc -lc $s`
	@@ filelen = $wcout[1] + $wcout[2]
	@@ totalchars += $filelen 
	if ($drive != "") then
		if ($curfloppy + $filelen >= ${MAXFLOPPY}) then
			echo "${PAUSECMD}" >> ${BATCH}
			echo "(End of floppy disk)"
			@@ curfloppy = 0
		endif
		@@ curfloppy += $filelen
	endif
	echo "${MLCMD} $s ${UTMP}$d" >> ${MLEXEC}
	echo "display -f ${UTMP}$d ${UTMP}T$d" >> ${BATCH}
	echo "copy ${UTMP}T$d ${drive}$d -a -v" >> ${BATCH}
	echo "del ${UTMP}T$d" >> ${BATCH}
end

echo ""
echo -n 'Type y to continue - '
if ("$<" != "y") exit

@@ totalchars /= $CHARRATE
echo "Expected running time - $totalchars minutes."
date
echo ""
echo -n "Hit RETURN to begin transfer "
set junk=$<
$RUNMLINK
date
rm -f $BATCH $MLEXEC
echo ""
echo "Now run DOWN on the Rainbow."
@


1.1
log
@Initial revision
@
text
@d8 1
a8 2
set SUFFIX=s
set RUNMLINK="/people/cmi/bin/mlink console e $MLEXEC"
d16 1
a16 1
@@ CHARRATE = 105 * 60
d49 1
a49 1
	set d="${cantica}`basename $s .${SUFFIX}`.${commentary}"
d80 1
a80 1

@
